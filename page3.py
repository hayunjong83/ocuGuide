import streamlit as st
from helper import autoplay_audio
from page2 import supabase
import time

def set_form_step(action,step=None):
    if action == 'Next':
        st.session_state['current_step'] = st.session_state['current_step'] + 1
    if action == 'Back':
        st.session_state['current_step'] = st.session_state['current_step'] - 1
    if action == 'Jump':
        st.session_state['current_step'] = step

def page_info():
    # í˜ì´ì§€ ì œëª©
    st.markdown(
    """
        ## ë°±ë‚´ì¥ ìˆ˜ìˆ  ì •ë³´
    """
    )

    if 'current_step' not in st.session_state:
        st.session_state['current_step'] = 0
        st.session_state['progress'] = 0

    # # ë‹¨ê³„ ì œëª©
    # step0 = "ì •ë³´ ì•ˆë‚´"
    # step1 = "ë‹¨ê³„ 1 ğŸ”’" if "step_1" not in st.session_state else "ë‹¨ê³„ 1"
    # step2 = "ë‹¨ê³„ 2 ğŸ”’" if "step_2" not in st.session_state else "ë‹¨ê³„ 2"
    # step3 = "ë‹¨ê³„ 3 ğŸ”’" if "step_3" not in st.session_state else "ë‹¨ê³„ 3"
    # step4 = "ë‹¨ê³„ 4 ğŸ”’" if "step_4" not in st.session_state else "ë‹¨ê³„ 4"
    # step5 = "ë‹¨ê³„ 5 ğŸ”’" if "step_5" not in st.session_state else "ë‹¨ê³„ 5"
    # step6 = ":red[í™˜ìë³„ ì •ë³´] ğŸ”’" if "step_6" not in st.session_state else ":red[í™˜ìë³„ ì •ë³´]"
    # # tab_lst = [step0, step1, step2, step3, step4, step5]
    # info_lst = [step0, step1, step2, step3, step4, step5]

    step0_type = 'primary' if st.session_state['current_step'] == 0 else 'secondary'
    step1_type = 'primary' if st.session_state['current_step'] == 1 else 'secondary'
    step2_type = 'primary' if st.session_state['current_step'] == 2 else 'secondary'
    step3_type = 'primary' if st.session_state['current_step'] == 3 else 'secondary'
    step4_type = 'primary' if st.session_state['current_step'] == 4 else 'secondary'
    step5_type = 'primary' if st.session_state['current_step'] == 5 else 'secondary'
    step6_type = 'primary' if st.session_state['current_step'] == 6 else 'secondary'

    step_cols= st.columns([1, 1, 1, 1, 1, 1, 2])    
    
    step_cols[0].button('ê°œìš”', on_click=set_form_step, args=['Jump', 0], type=step0_type)
    able_step_1 = True if st.session_state['progress'] < 1 else False
    step_cols[1].button('ë‹¨ê³„ 1', on_click=set_form_step, args=['Jump', 1], type=step1_type, disabled=able_step_1)        
    able_step_2 = True if st.session_state['progress'] < 2 else False
    step_cols[2].button('ë‹¨ê³„ 2', on_click=set_form_step, args=['Jump', 2], type=step2_type, disabled=able_step_2)
    able_step_3 = True if st.session_state['progress'] < 3 else False
    step_cols[3].button('ë‹¨ê³„ 3', on_click=set_form_step, args=['Jump', 3], type=step3_type, disabled=able_step_3)     
    able_step_4 = True if st.session_state['progress'] < 4 else False
    step_cols[4].button('ë‹¨ê³„ 4', on_click=set_form_step, args=['Jump', 4], type=step4_type, disabled=able_step_4)
    able_step_5 = True if st.session_state['progress'] < 5 else False
    step_cols[5].button('ë‹¨ê³„ 5', on_click=set_form_step, args=['Jump', 5], type=step5_type, disabled=able_step_5)
    able_step_6 = True if st.session_state['progress'] < 6 else False      
    step_cols[6].button('í™˜ìë³„ ì •ë³´', on_click=set_form_step, args=['Jump', 6], type=step6_type, disabled=able_step_6)

    st.markdown('---')
    personalized = False
    if 'patient_info' in st.session_state:
        if st.session_state['patient_info'] != None:
            personalized = True

    # ë‹¨ê³„ 0) ì •ë³´ ì•ˆë‚´
    if st.session_state['current_step'] == 0:
        with st.container():
            st.subheader("ì •ë³´ ê°œìš”")
            st.markdown(
            """
            **ë°±ë‚´ì¥ ìˆ˜ìˆ ì •ë³´**ì—ì„œëŠ” ë°±ë‚´ì¥ ìˆ˜ìˆ ì— ê´€í•˜ì—¬ í™˜ìë¶„ë“¤ê»˜ì„œ ê°€ì¥ ê¶ê¸ˆí•´í•˜ê³ , ê¼­ ì•Œì•„ì•¼ í•  ì •ë³´ë¥¼ :blue[**ë‹¨ê³„ë³„ë¡œ**] ì œê³µí•©ë‹ˆë‹¤.
            ìˆ˜ìˆ  ê³¼ì •ë¶€í„° íšŒë³µ, ì£¼ì˜ì‚¬í•­ê¹Œì§€ í•µì‹¬ì ì¸ ë‚´ìš©ì„ ë‹´ì•„ í™˜ìë¶„ë“¤ê»˜ì„œ ìˆ˜ìˆ  ì „ ì•ˆì‹¬í•˜ê³  ì¤€ë¹„í•  ìˆ˜ ìˆë„ë¡ ë•ê² ìŠµë‹ˆë‹¤. 

            - ì•ìœ¼ë¡œì˜ ë™ì˜ ê³¼ì •ì„ ìœ„í•´ì„œ, ê´€ë ¨ ì •ë³´ë¥¼ ë‹¨ê³„ë³„ë¡œ í™•ì¸í•´ì£¼ì„¸ìš”.
            - í•˜ë‚˜ì˜ ì •ë³´ë¥¼ í™•ì¸ í›„, :red[**ë‹¤ìŒ ë‹¨ê³„ë¡œ**]ë²„íŠ¼ì„ ëˆ„ë¥´ì‹œë©´ ë‹¤ìŒ ë‹¨ê³„ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

            í™˜ìë¶„ë“¤ê»˜ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆëŠ” ë‹¨ê³„ë³„ ì •ë³´ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
            - ë‹¨ê³„ 1) **ë°±ë‚´ì¥ ë° ë°±ë‚´ì¥ ìˆ˜ìˆ **
            - ë‹¨ê³„ 2) **ë°±ë‚´ì¥ ìˆ˜ìˆ ì—ì„œ ë Œì¦ˆì˜ ì¢…ë¥˜ ë° ë„ìˆ˜**
            - ë‹¨ê³„ 3) **ë°±ë‚´ì¥ ìˆ˜ìˆ  í›„ ì‹œë ¥, ì¼ìƒìƒí™œ**
            - ë‹¨ê³„ 4) **ë°±ë‚´ì¥ ìˆ˜ìˆ ì˜ ë¶€ì‘ìš© ë° í•©ë³‘ì¦**
            - ë‹¨ê³„ 5) **ìì£¼ ë¬»ëŠ” ì§ˆë¬¸**
            - ë‹¨ê³„ 6) **ìˆ˜ìˆ  í›„ ì£¼ì˜ì‚¬í•­ ë° í™˜ìë³„ ë§ì¶¤ì •ë³´**

            ë°±ë‚´ì¥ ìˆ˜ìˆ ì€ í™˜ì ë¶„ë“¤ì˜ ëˆˆ ê±´ê°•ì„ ìœ„í•œ ì•ˆì „í•˜ê³  íš¨ìœ¨ì ì¸ ì¹˜ë£Œë²•ì…ë‹ˆë‹¤. 
            ì„¸ë¸Œë€ìŠ¤ ì•ˆê³¼ë³‘ì›ì˜ ëª¨ë“  ì˜ë£Œì§„ì€ ì´ë¥¼ ìœ„í•´ ìµœì„ ì˜ ë…¸ë ¥ì„ ë‹¤í•˜ê³  ìˆìŠµë‹ˆë‹¤.
            ì´ í˜ì´ì§€ë¥¼ í†µí•´ ë°±ë‚´ì¥ì— ê´€í•œ ê¶ê¸ˆì¦ì„ í•´ê²°í•˜ì‹œê³ , ì•ˆì‹¬í•˜ê³  ìˆ˜ìˆ ì„ ì¤€ë¹„í•˜ì‹­ì‹œì˜¤.

            - ì¶”ê°€ì ì¸ ì§ˆë¬¸ì´ ìˆìœ¼ì‹  ê²½ìš°ì—ëŠ” :red[ :question: Q&A ì±—ë´‡]ì„ í†µí•˜ì—¬ ê°„ë‹¨í•˜ê²Œ ì•Œì•„ë³´ì„¸ìš”.
            - ì–¸ì œë“  ì£¼ì¹˜ì˜ ì„ ìƒë‹˜ì„ í†µí•˜ì—¬, ë” ìƒì„¸í•˜ê³  ì¹œì ˆí•œ ì„¤ëª…ì„ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            """)
            disable_step_0_again = True if st.session_state['progress'] > 0 else False
            unlock_step_1 = st.button("í™•ì¸í•˜ì˜€ìŠµë‹ˆë‹¤.", key="to_step_1", disabled=disable_step_0_again)
            if unlock_step_1:
                if 'patient_info' not in st.session_state:
                    st.warning("í™˜ì ì •ë³´ë¥¼ ë¨¼ì € ë“±ë¡í•´ì£¼ì„¸ìš”.")
                elif st.session_state['patient_info'] == None:
                    st.warning("í™˜ì ì •ë³´ë¥¼ ë¨¼ì € ë“±ë¡í•´ì£¼ì„¸ìš”.")
                else:
                    st.session_state['current_step'] = 1
                    st.session_state['progress'] += 1
                    st.rerun()

    # ë‹¨ê³„ 1) ë°±ë‚´ì¥ ë° ë°±ë‚´ì¥ ìˆ˜ìˆ 
    elif st.session_state['current_step'] == 1:
    # elif active_tab == step1:   
        with st.container():

            st.subheader("ë‹¨ê³„ 1) ë°±ë‚´ì¥ ë° ë°±ë‚´ì¥ ìˆ˜ìˆ ")

            # ë‚´ìš© 1-1
            st.markdown(
        """
        #### Q. ë°±ë‚´ì¥ì´ë€ ë¬´ì—‡ì¸ê°€ìš”?

        - ë°±ë‚´ì¥ì´ë€ ë…¸í™”ì— ì˜í•´ â€˜ì¹´ë©”ë¼ì˜ ë Œì¦ˆì— í•´ë‹¹í•˜ëŠ” ìˆ˜ì •ì²´â€™ì— í˜¼íƒì´ ìƒê¸°ëŠ” ê²ƒì…ë‹ˆë‹¤.
        - í˜„ì¬ë¡œì„œëŠ” ë°±ë‚´ì¥ì„ ì¹˜ë£Œí•  ìˆ˜ ìˆëŠ” ì•½ì œëŠ” ì—†ìœ¼ë©°, ë”°ë¼ì„œ ë°±ë‚´ì¥ì€ ë°˜ë“œì‹œ ìˆ˜ìˆ ì  ì¹˜ë£Œë¥¼ í•´ì•¼í•˜ëŠ” ì§ˆí™˜ì…ë‹ˆë‹¤.
        """)

            # ë‚´ìš© 1-2
            st.markdown(
        """
        #### Q. ë°±ë‚´ì¥ ìˆ˜ìˆ ì€ ì–´ë–»ê²Œ ì§„í–‰ë˜ë‚˜ìš”?

        ë°±ë‚´ì¥ ìˆ˜ìˆ ì€ ë‹¤ìŒê³¼ ê°™ì€ 2ê°€ì§€ ê³¼ì •ìœ¼ë¡œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤. 
        1) **í˜¼íƒí•´ì§„ ë°±ë‚´ì¥ì„ ì œê±°**í•˜ê³  (Phacoemulsification)
        2) ìˆ˜ì •ì²´ ì—­í• ì„ ëŒ€ì‹ í•  **ì¸ê³µìˆ˜ì •ì²´(=ë Œì¦ˆ)ë¥¼ ë„£ëŠ” ê²ƒ** (IOL implantation)
        """)
            
            # ë‚´ìš© 1-3
            st.markdown(
        """
        #### Q. ë°±ë‚´ì¥ ìˆ˜ìˆ  ì‹œ ë§ˆì·¨ëŠ” ì–´ë– í•œ ë°©ì‹ìœ¼ë¡œ í•˜ë‚˜ìš”?

        - ì¼ë°˜ì ìœ¼ë¡œ ì ì•ˆ ë§ˆì·¨ ë° êµ­ì†Œë§ˆì·¨ë¡œ ì§„í–‰ë©ë‹ˆë‹¤.
        - ì˜ˆì™¸ì ìœ¼ë¡œ í˜‘ì¡°ê°€ ì–´ë ¤ìš´ í™˜ìì˜ ê²½ìš°ì—ëŠ” ì „ì‹ ë§ˆì·¨ë¡œ ì§„í–‰í•˜ê²Œ ë©ë‹ˆë‹¤.
        - **íì‡„ê³µí¬ì¦**ì´ ìˆê±°ë‚˜, 30ë¶„ ì •ë„ ê°€ë§Œíˆ ëˆ„ì›Œ ê³„ì‹œê¸°ë‚˜ ì–´ë µê±°ë‚˜, ëˆˆì„ ê°€ë§Œíˆ ìˆê¸°ê°€ ì–´ë ¤ìš´ ë¶„ë“¤ì€ ì‚¬ì „ì— ì£¼ì¹˜ì˜ì—ê²Œ ê¼­ ë§ì”€í•´ì£¼ì‹œê¸¸ ë°”ëë‹ˆë‹¤.
        """)
            
            # ë‚´ìš© 1-4
            st.markdown(
        """
        #### Q. ë°±ë‚´ì¥ ìˆ˜ìˆ  ì…ì›ì€ ë©°ì¹  ë™ì•ˆ í•˜ë‚˜ìš”?

        - ë°±ë‚´ì¥ ìˆ˜ìˆ ì€ ì¼ì¼ì…ì›(ë‹¹ì¼ ì…ì›, ë‹¹ì¼ í‡´ì›)ìœ¼ë¡œ ì§„í–‰ë©ë‹ˆë‹¤.
        - ë‹¹ì¼ ë‚´ì›ì‹œê°„ì€ ì „ë‚ ì— ì „í™” ë° ë¬¸ìë©”ì„¸ì§€ë¡œ ì•ˆë‚´í•´ë“œë¦¬ë‹ˆ ì „í™”ë¥¼ ì˜ ë°›ì•„ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.
        - ì¼ë°˜ì ìœ¼ë¡œ ìˆ˜ìˆ  1-2ì‹œê°„ ì „ì— ë„ì°©í•˜ì—¬ ì‚°ë™ì œë¥¼ ì ì•ˆí•˜ê¸° ì‹œì‘í•˜ë©°, ì‚°ë™ì´ ì¶©ë¶„íˆ ëœ í›„ì— ìˆ˜ìˆ ì„ ì§„í–‰í•˜ê²Œ ë©ë‹ˆë‹¤. 
        """)

            # ì¶”ê°€ ì˜ìƒ
            with st.expander("ë°±ë‚´ì¥ ìˆ˜ìˆ ì˜ìƒ"):
                st.markdown("### ë°±ë‚´ì¥ ìˆ˜ìˆ  ì˜ìƒ")
                st.markdown(
                """
                <div style="display: flex; justify-content: center;">
                    <iframe src="https://drive.google.com/file/d/1DTmGn-RaQs9R7T3k1VfbPf1TiOQ0xki0/preview" 
                            style="width: 90%; height: auto; aspect-ratio: 16/9;" 
                            frameborder="0" allowfullscreen></iframe>
                </div>
                """,
                unsafe_allow_html=True)
            
            disable_step_1_again = True if st.session_state['progress'] > 1 else False
            unlock_step_2 = st.button("í™•ì¸í•˜ì˜€ìŠµë‹ˆë‹¤.", key="to_step_2", disabled=disable_step_1_again)
            if unlock_step_2:
                # st.session_state["step_2"] = True
                # st.session_state["active_tab"] = "ë‹¨ê³„ 2"
                st.session_state['current_step'] = 2
                st.session_state['progress'] += 1
                st.rerun()

    # ë‹¨ê³„ 2) ë°±ë‚´ì¥ ìˆ˜ìˆ ì—ì„œ ë Œì¦ˆì˜ ì¢…ë¥˜ ë° ë„ìˆ˜
    elif st.session_state['current_step'] == 2:
        with st.container():
        
            st.subheader("ë‹¨ê³„ 2) ë°±ë‚´ì¥ ìˆ˜ìˆ ì—ì„œ ë Œì¦ˆì˜ ì¢…ë¥˜ ë° ë„ìˆ˜")

            # ë‚´ìš© 2-1
            st.markdown(
        """
        #### Q. ë°±ë‚´ì¥ ìˆ˜ìˆ ì‹œ ëˆˆì˜ ë„ìˆ˜ëŠ” ì–´ë–»ê²Œ ë˜ë‚˜ìš”?

        - ì‚¬ëŒì˜ ëˆˆì€ ì›ë˜ ìˆ˜ì •ì²´ì˜ ë‘ê»˜ë¥¼ ì¡°ì ˆí•˜ì—¬ ë¨¼ê±°ë¦¬ì™€ ê·¼ê±°ë¦¬ë¥¼ ëª¨ë‘ ì˜ ë³¼ ìˆ˜ ìˆìœ¼ë©°, ì´ëŸ¬í•œ ê¸°ëŠ¥ì´ ë–¨ì–´ì ¸ ì¼ë°˜ì ìœ¼ë¡œ ê°€ê¹Œìš´ ê±°ë¦¬ë¥¼ ì˜ ëª»ë³´ê²Œ ë˜ëŠ” ê²ƒì„ â€˜ë…¸ì•ˆâ€™ì´ë¼ê³  í•©ë‹ˆë‹¤.
        - ë°±ë‚´ì¥ ìˆ˜ìˆ  í›„ì—ëŠ” ì´ëŸ¬í•œ ì¡°ì ˆë ¥ì´ ì‚¬ë¼ì§€ê¸°ì— ëˆˆì´ ë‹¨ì´ˆì  ìƒíƒœê°€ ë˜ì–´, ë¨¼ê±°ë¦¬ì™€ ê·¼ê±°ë¦¬ ì¤‘ í•˜ë‚˜ë§Œ ì˜ ë³¼ ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.
        - (ì˜ˆì™¸ì ìœ¼ë¡œ ë‹¤ì´ˆì ë Œì¦ˆë¥¼ ë„£ê²Œ ë˜ë©´ ë¨¼ê±°ë¦¬ì™€ ê·¼ê±°ë¦¬ë¥¼ ëª¨ë‘ ì˜ ë³¼ ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.)
        """)
            
            # ë‚´ìš© 2-2
            st.markdown(
        """
        #### Q. ë°±ë‚´ì¥ ìˆ˜ìˆ ì‹œ ë„£ì„ ìˆ˜ ìˆëŠ” ì¸ê³µìˆ˜ì •ì²´ (=ë Œì¦ˆ)ì˜ ì¢…ë¥˜ì—ëŠ” ì–´ë–¤ ê²ƒì´ ìˆë‚˜ìš”?

        1) ì¼ë°˜ ë Œì¦ˆ

        2) ë‹¤ì´ˆì ë Œì¦ˆ (Multifocal)
            - ë¨¼ê±°ë¦¬ì™€ ê°€ê¹Œìš´ê±°ë¦¬(30cm)ë¥¼ ë‘˜ ë‹¤ ì˜ ë³´ì´ê²Œ í•˜ëŠ” ì¥ì ì´ ìˆì–´ ë…¸ì•ˆêµì •ì„ ì›í•˜ì‹œëŠ” ë¶„ë“¤ì—ê²Œ ì¶”ì²œë“œë¦´ ìˆ˜ ìˆì§€ë§Œ, ë¶€ì‘ìš©ìœ¼ë¡œ ë¹›ë²ˆì§, ì‹œì•¼íë¦¼ ë“±ì´ ë‚˜íƒ€ë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        
        3) ì•„ì´í—¨ìŠ¤ë Œì¦ˆ (Eyhance)
            - ë‹¤ì´ˆì ë Œì¦ˆì˜ ë¶€ì‘ìš©ì€ ì—†ìœ¼ë©´ì„œ ë¨¼ê±°ë¦¬ì™€ ì¤‘ê°„ê±°ë¦¬(50cm)ì„ ì˜ ë³´ì´ê²Œ í•˜ëŠ” ë Œì¦ˆì…ë‹ˆë‹¤.

        4) ë‚œì‹œêµì •ë Œì¦ˆ (Toric)
            - ë‚œì‹œê°€ ì‹¬í•œ ê²½ìš° ë‚œì‹œêµì •ë Œì¦ˆë¥¼ ê³ ë ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

        - í•œë²ˆ ìˆ˜ìˆ ì„ í•˜ê²Œ ë˜ë©´ ë Œì¦ˆì˜ êµì²´ëŠ” ì–´ë µê¸°ì— ìˆ˜ìˆ  ì „ ì£¼ì¹˜ì˜ì™€ ì¶©ë¶„íˆ ìƒì˜í•˜ì—¬ ê°œê°œì¸ì˜ ì—°ë ¹ ë° ëˆˆìƒíƒœì— ë”°ë¼ ì•Œë§ì€ ë Œì¦ˆë¥¼ ì˜ ê²°ì •í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.
        - ìˆ˜ìˆ  í›„ ë„ìˆ˜ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ë¨¼ê±°ë¦¬ê°€ ì˜ë³´ì´ëŠ” ì •ì‹œ ë„ìˆ˜ë¡œ ì§„í–‰í•˜ì§€ë§Œ, ê³ ë„ê·¼ì‹œ, ê·¼ê±°ë¦¬ ì‘ì—…ì„ ë§ì´ í•˜ì‹œëŠ” ë¶„ë“¤ì˜ ê²½ìš°ì—ëŠ” ì˜ˆì™¸ì ìœ¼ë¡œ ê·¼ê±°ë¦¬ê°€ ì˜ë³´ì´ëŠ” ê·¼ì‹œ ë„ìˆ˜ë¡œ ì§„í–‰í•˜ê¸°ë„ í•©ë‹ˆë‹¤.
        - ë Œì¦ˆ ë° ë„ìˆ˜ì˜ ê²°ì •ì€ ì£¼ì¹˜ì˜ì„ ìƒë‹˜ì˜ ì„¤ëª…ì„ ì¶©ë¶„íˆ ë“¤ì€í›„ì— ê²°ì •í•˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤.
        """)
            
            disable_step_2_again = True if st.session_state['progress'] > 2 else False
            unlock_step_3 = st.button("í™•ì¸í•˜ì˜€ìŠµë‹ˆë‹¤.", key="to_step_3", disabled=disable_step_2_again)
            if unlock_step_3:
                # st.session_state["step_3"] = True
                # st.session_state["active_tab"] = "ë‹¨ê³„ 3"
                st.session_state['current_step'] = 3
                st.session_state['progress'] += 1
                st.rerun()

    # ë‹¨ê³„ 3) ë°±ë‚´ì¥ ìˆ˜ìˆ  í›„ ì‹œë ¥, ì¼ìƒìƒí™œ
    elif st.session_state['current_step'] == 3:
        with st.container():
            st.subheader("ë‹¨ê³„ 3) ë°±ë‚´ì¥ ìˆ˜ìˆ  í›„ ì‹œë ¥, ì¼ìƒìƒí™œ")
            
            # ë‚´ìš© 3-1 : *****í™˜ìë³„ ì •ë³´ ì…ë ¥ í›„ì—ëŠ” ìˆ˜ì •í•  ìˆ˜ ìˆë„ë¡ í•¨
            st.markdown(
        """
        #### Q. ë°±ë‚´ì¥ ìˆ˜ìˆ  í›„ì—ëŠ” ë°”ë¡œ ì˜ ë³´ì´ê²Œ ë˜ë‚˜ìš”?

        - ë°±ë‚´ì¥ ìˆ˜ìˆ  í›„ 1~2ë‹¬ ì •ë„ ë’¤ì— ì •í™•í•œ ë„ìˆ˜ ë° ì‹œë ¥ì´ ë‚˜ì˜¤ê²Œ ë©ë‹ˆë‹¤.
        - ì¼ë°˜ì ìœ¼ë¡œ ì´ ë•Œ, ì•ˆê²½ê²€ì‚¬ë¥¼ ì§„í–‰í•˜ê³  í•„ìš”í•˜ë©´ ë‹ë³´ê¸°ë¥¼ ì²˜ë°©í•˜ê²Œ ë©ë‹ˆë‹¤.
        - ìˆ˜ìˆ  ì§í›„ì—ëŠ” ê°ë§‰ ë¶€ì¢… ë“±ìœ¼ë¡œ ì˜¤íˆë ¤ ì‹œë ¥ì´ ë–¨ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

        - ë§ë§‰ì§ˆí™˜, ë…¹ë‚´ì¥ ë“± ê¸°ì € ì•ˆì§ˆí™˜ì´ ë™ë°˜ë˜ì–´ ìˆëŠ” ê²½ìš°ì—ëŠ” ì‹œë ¥ íšŒë³µì´ ì œí•œë  ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.
        """)
            
            # ë‚´ìš© 3-2
            st.markdown(
        """
        #### Q. ë°±ë‚´ì¥ ìˆ˜ìˆ  ì´í›„ ì¼ìƒìƒí™œì€ ì–¸ì œë¶€í„° ê°€ëŠ¥í•œê°€ìš”?

        - ë°±ë‚´ì¥ ìˆ˜ìˆ  ë‹¹ì¼ë¶€í„° ì¼ìƒ ìƒí™œì€ ê°€ëŠ¥í•©ë‹ˆë‹¤. (ì‹ì‚¬ì—ë„ ì œì•½ì€ ì—†ìŠµë‹ˆë‹¤.)
        - ë‹¤ë§Œ, **ì„¸ìˆ˜ì™€ ìƒ¤ì›ŒëŠ” ì¼ì£¼ì¼ ë’¤ë¶€í„° ê°€ëŠ¥í•©ë‹ˆë‹¤.**
        """)
            
            # ë‚´ìš© 3-3
            st.markdown(
        """
        #### Q. ë°±ë‚´ì¥ ìˆ˜ìˆ  í›„ì—ëŠ” ì•ˆì•½ì„ ì–¼ë§ˆë‚˜ ì‚¬ìš©í•˜ë‚˜ìš”?

        - ì¼ë°˜ì ìœ¼ë¡œ ìˆ˜ìˆ  í›„ì—ëŠ” í•­ìƒì œ, í•­ì—¼ì¦ì œ ë“± ì•ˆì•½ì„ ì•½ í•œë‹¬ ê°„ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤.
        - ë‹¤ë§Œ, í•„ìš”ì— ë”°ë¼ì„œ ì•ˆì•½ì„ ì¶”ê°€í•˜ê±°ë‚˜ ë” ì˜¤ë˜ ì‚¬ìš©í•˜ê²Œ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        """)
            
            # ë‚´ìš© 3-4
            st.markdown(
        """
        #### Q. ë°±ë‚´ì¥ ìˆ˜ìˆ  í›„ì—ëŠ” ë³‘ì›ì— ì–¼ë§ˆë‚˜ ìì£¼ ì™€ì•¼í•˜ë‚˜ìš”?

        - ìˆ˜ìˆ ì¼ ê¸°ì¤€ ë‹¤ìŒë‚ , 1ì£¼ì¼, 1ê°œì›”, 3-6ê°œì›” ì£¼ê¸°ë¡œ ë‚´ì›í•˜ê²Œ ë©ë‹ˆë‹¤.
        - ë‹¤ë§Œ í•„ìš”ì— ë”°ë¼ì„œ ì¡°ê¸ˆ ì´ë¥¸ ì£¼ê¸°ë¡œ ê²½ê³¼ê´€ì°°í•˜ê²Œ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        """)
            
            disable_step_3_again = True if st.session_state['progress'] > 3 else False
            unlock_step_4 = st.button("í™•ì¸í•˜ì˜€ìŠµë‹ˆë‹¤.", key="to_step_4", disabled=disable_step_3_again)
            if unlock_step_4:
                # st.session_state["step_4"] = True
                # st.session_state["active_tab"] = "ë‹¨ê³„ 4"
                st.session_state['current_step'] = 4
                st.session_state['progress'] += 1
                st.rerun()

    # ë‹¨ê³„ 4) ë°±ë‚´ì¥ ìˆ˜ìˆ ì˜ ë¶€ì‘ìš© ë° í•©ë³‘ì¦
    elif st.session_state['current_step'] == 4:
        with st.container():
            st.subheader("ë‹¨ê³„ 4) ë°±ë‚´ì¥ ìˆ˜ìˆ ì˜ ë¶€ì‘ìš© ë° í•©ë³‘ì¦")

            # ë‚´ìš© 4-1 : *****í™˜ìë³„ ì •ë³´ ì…ë ¥ í›„ì—ëŠ” ìˆ˜ì •í•  ìˆ˜ ìˆë„ë¡ í•¨
            st.markdown(
        """
        #### Q. ë°±ë‚´ì¥ ìˆ˜ìˆ ì˜ ë¶€ì‘ìš©ì—ëŠ” ì–´ë–¤ ê²ƒë“¤ì´ ìˆë‚˜ìš”?

        - ë°±ë‚´ì¥ ìˆ˜ìˆ ì˜ ë¶€ì‘ìš©ì€ í¬ê²Œ 'ìˆ˜ìˆ  ì¤‘ í•©ë³‘ì¦'ê³¼ 'ìˆ˜ìˆ  í›„ ë¶€ì‘ìš©/í•©ë³‘ì¦' ìœ¼ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

        1) ìˆ˜ìˆ  ì¤‘ í•©ë³‘ì¦
        - ë°±ë‚´ì¥ ìˆ˜ìˆ  ë„ì¤‘ ë°œìƒí•  ìˆ˜ ìˆëŠ” í•©ë³‘ì¦ì€ ì—¬ëŸ¬ê°€ì§€ê°€ ìˆìœ¼ë‚˜ ê°€ì¥ ì¤‘ìš”í•œ í•©ë³‘ì¦ì€ **í›„ë‚­íŒŒì—´ (Posterior capsular rupture)** ê³¼ **ìœ ë¦¬ì²´ì†ì‹¤ (Vitreous prolapse)**ì…ë‹ˆë‹¤. 
        - ì´ëŠ” ë°±ë‚´ì¥ ìˆ˜ìˆ ê³¼ì •ì˜ ì•½ 5%ì—ì„œ ë‚˜íƒ€ë‚  ìˆ˜ ìˆëŠ” ìˆ˜ìˆ  ì¤‘ í•©ë³‘ì¦ì´ë©°, íŠ¹íˆ ë‚œì´ë„ê°€ ë†’ì€ ë°±ë‚´ì¥ ìˆ˜ìˆ ì—ì„œ í™•ë¥ ì´ ì¦ê°€í•©ë‹ˆë‹¤.
        - ì´ëŸ¬í•œ ê²½ìš°ì—ëŠ” ì˜ˆì •ëœ ë Œì¦ˆê°€ ì•„ë‹Œ ë‹¤ë¥¸ ì¢…ë¥˜ì˜ ì¼ë°˜ë Œì¦ˆë¥¼ ë„£ê³  ë‚˜ì˜¤ê²Œ ë  ê°€ëŠ¥ì„±ì´ ìˆìœ¼ë©°, ìœ ë¦¬ì²´ì ˆì œìˆ ê¹Œì§€ ìˆ˜ìˆ ì´ í™•ëŒ€ë  ê°€ëŠ¥ì„± ë˜í•œ ìˆìŠµë‹ˆë‹¤.

        2) ìˆ˜ìˆ  í›„ ê²½ë¯¸í•œ ë¶€ì‘ìš©
        - ê²½ë¯¸í•œ ìˆ˜ìˆ  ë¶€ì‘ìš©ìœ¼ë¡œëŠ” 'ê±´ì¡°ì¦, ì´ë¬¼ê°, ë¹„íŠ¹ì´ì ì¸ ëˆˆì£¼ë³€ ë¶ˆí¸ê°, ì¶©í˜ˆ, ê²°ë§‰í•˜ì¶œí˜ˆ' ë“±ì´ ìˆìŠµë‹ˆë‹¤.
        - ìˆ˜ìˆ ì‹œ ëˆˆì„ ê¸°êµ¬ë¡œ ê°•ì œë¡œ ë²Œë¦° í›„ì— ëˆˆê¹œë¹¡ì„ ì—†ì´ 20-30ë¶„ ì •ë„ ì§„í–‰í•˜ê¸° ë•Œë¬¸ì—, ìˆ˜ìˆ  í›„ ê±´ì¡°ì¦ì€ í•„ì—°ì ìœ¼ë¡œ ì•…í™”ë˜ê²Œ ë©ë‹ˆë‹¤. 
        - ê±´ì¡°ì¦, ì´ë¬¼ê°ì€ ìƒë‹¹ê¸°ê°„ ì˜¤ë˜ ì§€ì†ë  ìˆ˜ ìˆìœ¼ë©° ì´ë¡œ ì¸í•œ ë¶ˆí¸ê°ì´ ë‚˜íƒ€ë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        - ìˆ˜ìˆ  í›„ ì¶©í˜ˆ ë° ê²°ë§‰í•˜ì¶œí˜ˆì€ ìì—°ìŠ¤ëŸ½ê²Œ ë‚˜íƒ€ë‚˜ë©° 2-4ì£¼ ì•ˆì— ìì—°ì†Œë©¸ë©ë‹ˆë‹¤.
        - **ë¹„ë¬¸ì¦(ë‚ íŒŒë¦¬ì¦)** ë˜í•œ í”í•œ ë¶€ì‘ìš© ì¤‘ í•˜ë‚˜ì´ë©°, ìˆ˜ìˆ  ì´í›„ ì´ë¡œ ì¸í•œ ë¶ˆí¸ê°ì´ ë‚˜íƒ€ë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

        3) ìˆ˜ìˆ  í›„ ì‹¬í•œ í•©ë³‘ì¦
        - ê°€ì¥ ì‹¬ê°í•œ ë¶€ì‘ìš©ìœ¼ë¡œëŠ” **ìˆ˜ìˆ  í›„ ê°ì—¼**ì´ ìˆìŠµë‹ˆë‹¤.
        - ì´ë¥¼ ì˜ˆë°©í•˜ê¸° ìœ„í•´ ì¶©ë¶„í•œ ì†Œë…ì„ í•˜ê³  ë¬´ê· ì ìœ¼ë¡œ ìˆ˜ìˆ ì„ ì§„í–‰í•˜ë©°,
        - ìˆ˜ìˆ  í›„ì—ë„ í•­ìƒì œ ì•ˆì•½ì„ ì ì•ˆí•˜ê³ , ëˆˆì„ ë¹„ë¹„ì§€ ì•Šê³ , ì¼ì£¼ì¼ê°„ ëˆˆì— ë¬¼ì´ ë“¤ì–´ê°€ì§€ ì•Šë„ë¡ êµìœ¡í•˜ì§€ë§Œ, ê·¸ëŸ¼ì—ë„ 1/1000 í™•ë¥ ë¡œ ë°œìƒ ê°€ëŠ¥í•œ ì¤‘ìš”í•œ ë¶€ì‘ìš©ì…ë‹ˆë‹¤. 

        - ìˆ˜ìˆ  í›„ ê°‘ì‘ìŠ¤ëŸ° ì‹œë ¥ì €í•˜, í†µì¦, ì‹¬í•œì¶©í˜ˆ ë°œìƒì‹œ, ê°ì—¼ì˜ ì´ˆê¸° ì¦ìƒì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì¦‰ì‹œ ë‚´ì›í•˜ì…”ì•¼ í•©ë‹ˆë‹¤.
        - ìˆ˜ìˆ  í›„ ê°ì—¼ ë°œìƒì‹œì—ëŠ” ë°˜ë³µì ì¸ ì•ˆêµ¬ë‚´ì£¼ì‚¬ í˜¹ì€ ì¬ìˆ˜ìˆ  (ìœ ë¦¬ì²´ì ˆì œìˆ )ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

        - ì´ì™¸ì—ë„ ë°±ë‚´ì¥ ìˆ˜ìˆ  ì´í›„ ì•ˆê²€í•˜ìˆ˜, ë³µì‹œ, ë§ë§‰ë°•ë¦¬ ë“±ì˜ í•©ë³‘ì¦ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

        4) ìˆ˜ìˆ  í›„ ì¥ê¸°ì ì¸ í•©ë³‘ì¦
        - (1) ë Œì¦ˆì˜ íƒˆêµ¬/ì•„íƒˆêµ¬
            + ë°±ë‚´ì¥ ìˆ˜ìˆ  ì´í›„ì—ë„ ìì—°ìŠ¤ëŸ½ê²Œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì¥ê¸°ì ì¸ í•©ë³‘ì¦ìœ¼ë¡œ, ë°±ë‚´ì¥ì„ ì§€ì§€í•´ì£¼ë˜ ì†ŒëŒ€ê°€ ì•½í•œ ê²½ìš°ì—ì„œ ë°œìƒí•  ê°€ëŠ¥ì„± ë†’ìŠµë‹ˆë‹¤.
            + ë Œì¦ˆê°€ íƒˆêµ¬/ì•„íƒˆêµ¬ëœ ê²½ìš°ì—ëŠ” ì¬ìˆ˜ìˆ  (ìœ ë¦¬ì²´ì ˆì œìˆ  ë° ì´ì°¨ì  ì¸ê³µìˆ˜ì •ì²´ ì‚½ì…ìˆ )ì´ í•„ìš”í•˜ê²Œ ë©ë‹ˆë‹¤.
        - (2) ê°ë§‰ë¶€ì¢…
            + ì´ëŠ” ìˆ˜ìˆ  ì§í›„ì—ë„ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë¶€ì‘ìš©ìœ¼ë¡œ ìˆ˜ìˆ  ì „ ê°ë§‰ë‚´í”¼ì„¸í¬ê°€ ì¢‹ì§€ ì•Šê±°ë‚˜, ì‹¬í•œ ë°±ë‚´ì¥ìœ¼ë¡œ ìˆ˜ìˆ  ì‹œ ë§ì€ ì—´ì—ë„ˆì§€ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ê²½ìš° ë°œìƒí•  í™•ë¥ ì´ ì¦ê°€í•©ë‹ˆë‹¤.
            + ê°ë§‰ë¶€ì¢…ìœ¼ë¡œ ì¸í•´ ì‹œë ¥íšŒë³µì´ ë”ë”œ ìˆ˜ ìˆìœ¼ë©°, ì¥ê¸°ê°„ ì§€ì†ë˜ëŠ” ê²½ìš° ê°ë§‰ì´ì‹ìˆ ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        - (3) í›„ë‚­í˜¼íƒ (=í›„ë°œë°±ë‚´ì¥)
            + ì´ëŠ” ìˆ˜ìˆ  ì´í›„ì— ìì—°ìŠ¤ëŸ½ê²Œ ìƒê¸¸ ìˆ˜ ìˆëŠ” í•©ë³‘ì¦ìœ¼ë¡œ ì¬ìˆ˜ìˆ ì´ ì•„ë‹Œ ê°„ë‹¨í•œ â€˜YAG ë ˆì´ì ¸ ì‹œìˆ â€™ì„ í†µí•´ ì œê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

        """)
            
            disable_step_4_again = True if st.session_state['progress'] > 4 else False
            unlock_step_5 = st.button("í™•ì¸í•˜ì˜€ìŠµë‹ˆë‹¤.", key="to_step_5", disabled=disable_step_4_again)
            if unlock_step_5:
                # st.session_state["step_5"] = True
                # st.session_state["active_tab"] = "ë‹¨ê³„ 5"
                st.session_state['current_step'] = 5
                st.session_state['progress'] += 1
                st.rerun()
        
    ## ë‹¨ê³„ 5ì™€ ë‹¨ê³„ 6ì€ ë™ì‹œ í™œì„±í™”í•˜ê³  ìˆœì„œ ë°”ê¾¸ê¸°
    # ë‹¨ê³„ 5) ìì£¼ ë¬»ëŠ” ì§ˆë¬¸
    elif st.session_state['current_step'] == 5:
        with st.container():
            st.subheader("ë‹¨ê³„ 5) ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ë“¤")

            # ë‚´ìš© 5-1
            st.markdown(
        """
        #### Q. ì–‘ìª½ ëˆˆì„ ë™ì‹œì— ìˆ˜ìˆ ì´ ê°€ëŠ¥í•œê°€ìš”?

        - ì¼ë°˜ì ìœ¼ë¡œ í•œ ëˆˆì”© ì§„í–‰í•˜ì§€ë§Œ, ì›í•˜ë©´ í•œ ë²ˆì— ì–‘ì•ˆ ìˆ˜ìˆ ì´ ê°€ëŠ¥í•˜ê¸°ë„ í•©ë‹ˆë‹¤.
        - ê·¸ëŸ¬ë‚˜ ëŒ€ë¶€ë¶„ì€ í•œìª½ ëˆˆ ìˆ˜ìˆ  ê²½ê³¼ë¥¼ ë³´ë©° ë°˜ëŒ€ìª½ ëˆˆ ìˆ˜ìˆ ì„ ê²°ì •í•˜ê²Œ ë©ë‹ˆë‹¤.
        - ë‹¤ë§Œ, ì „ì‹ ë§ˆì·¨ë¡œ í•˜ëŠ” ê²½ìš°ì—ëŠ” ì–‘ì•ˆì„ ë™ì‹œì— ìˆ˜ìˆ í•˜ê²Œ ë©ë‹ˆë‹¤.
        """)
            
            # ë‚´ìš© 5-2
            st.markdown(
        """
        #### Q. ìˆ˜ìˆ  ë‹¹ì¼ì—ëŠ” ì–´ë–»ê²Œ ì¤€ë¹„í•´ì•¼ í•˜ë‚˜ìš”?

        - ë³´í†µ ìˆ˜ìˆ  ì „ë‚  ì˜¤ì „ì— ë‚´ì›ì‹œê°„ ë° ì¥ì†Œì— ëŒ€í•œ ì•ˆë‚´ê°€ ìœ ì„ ìœ¼ë¡œ ì§„í–‰ë˜ê¸°ì—, ì „í™”ë¥¼ ì˜ ë°›ì•„ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤. ì•ˆë‚´ ë¬¸ìë„ í•¨ê»˜ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.
        - ìˆ˜ìˆ ì•ˆì´ ì¶©ë¶„íˆ ì‚°ë™ë˜ì–´ì•¼ ì˜ ì§„í–‰ë  ìˆ˜ ìˆê¸°ì—, ë³´í†µ ìˆ˜ìˆ  1~2ì‹œê°„ ì „ì— ë„ì°©í•˜ì—¬ ì‚°ë™ì œë¥¼ ì ì•ˆí•˜ê²Œ ë©ë‹ˆë‹¤.
        - ìˆ˜ìˆ  ì´í›„ì—ëŠ” ê°„í˜¸ì‚¬ì˜ ì„¤ëª…ì„ ë“¤ì€ í›„ì—, í‡´ì›ì•½ì´ ì¤€ë¹„ë˜ëŠ” ëŒ€ë¡œ ë°”ë¡œ í‡´ì› ê°€ëŠ¥í•©ë‹ˆë‹¤.
        """)
            
            # ë‚´ìš© 5-3
            st.markdown(
        """
        #### Q. ë°±ë‚´ì¥ ìˆ˜ìˆ  ì „ì— ë³µìš©í•˜ì§€ ë§ì•„ì•¼ í•  ì•½ì œê°€ ìˆì„ê¹Œìš”?

        - ì¼ë°˜ì ìœ¼ë¡œ í”¼ê°€ ë§ì´ë‚˜ëŠ” ìˆ˜ìˆ ì€ ì•„ë‹ˆê¸°ì— í•­í˜ˆì†ŒíŒì œ, í•­ì‘ê³ ì œëŠ” ìœ ì§€í•˜ë©° ìˆ˜ìˆ í•©ë‹ˆë‹¤.
        - ìˆ˜ìˆ  ë‹¹ì¼ ì•„ì¹¨ê¹Œì§€ ë³µìš©í•˜ì…”ë„ ë©ë‹ˆë‹¤.
        - ì „ë¦½ì„  ì•½ì œë¥¼ ë³µìš©í•˜ëŠ” ê²½ìš° ë™ê³µí™•ëŒ€ë¥¼ ì €í•˜ì‹œì¼œ, ìˆ˜ìˆ  ë‚œì´ë„ê°€ ë†’ì•„ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        - ë‹¤ë§Œ ëª¨ë“  ì•½ì œëŠ” ìˆ˜ìˆ  ì „ ì£¼ì¹˜ì˜ì™€ ìƒì˜ í›„ ë³µìš©í•˜ì…”ì•¼ í•©ë‹ˆë‹¤.
        """)
            
            disable_step_5_again = True if st.session_state['progress'] > 5 else False
            unlock_step_6 = st.button("í™•ì¸í•˜ì˜€ìŠµë‹ˆë‹¤.", key="to_step_6", disabled=disable_step_5_again)
            if unlock_step_6:
                # st.session_state["step_6"] = True
                # st.session_state["active_tab"] = ":red[í™˜ìë³„ ì •ë³´]"
                st.session_state['current_step'] = 6
                st.session_state['progress'] += 1
                st.rerun()
            
    elif st.session_state['current_step'] == 6:
        if not personalized:
            st.error("íšŒì›ì •ë³´ë¥¼ ë¨¼ì € ë“±ë¡í•´ì£¼ì‹­ì‹œì˜¤.")
            # st.session_state["active_tab"] = step0

        else:
            with st.container():
                diag = st.session_state['patient_info']['diagnosis']
                patient_name = st.session_state['patient_info']['patient_name']
                # st.write(st.session_state['patient_info']['diagnosis'])
                st.subheader("ì¢…í•© ì†Œê²¬")
                contents = personalized_diagnosis(diag, patient_name)
                st.write(contents)

                with st.container(border=True):
                    explain = st.session_state["patient_info"]["explain"]
                    explain = explain.replace("#","")
                    st.write("**(LLM ìƒì„±)í™˜ì ìƒíƒœì— ê´€í•œ ì¢…í•© ì†Œê²¬**")
                    st.write(explain)

                st.write("---")
                st.write("#### ì„¸ë¶€ ë‚´ìš©")

                for cat, details in diag.items():
                    if len(details) == 0:
                        continue
                    with st.container(border=True):
                        st.write(f"**{cat} ì´ìƒ**")
                        for detail in details:    
                            res = supabase.table("diagnosis").select("explain").eq("diag", detail).execute()
                            raw = res.data[0]['explain'].replace("{patient}", patient_name)
                            st.write(raw)
                            st.write("---")
    
    st.markdown('---')
    disable_back_button = True if st.session_state['current_step'] == 0 else False
    if st.session_state['current_step'] == 6 or st.session_state['current_step'] >= st.session_state['progress']:
        disable_next_button = True
    else:
        disable_next_button = False
    # disable_next_button = True if st.session_state['current_step'] == 6 else False

    form_footer_cols = st.columns([1,5,1])

    form_footer_cols[0].button('ì´ì „',on_click=set_form_step, args=['Back'], disabled=disable_back_button)
    form_footer_cols[2].button('ë‹¤ìŒ',on_click=set_form_step, args=['Next'], disabled=disable_next_button)

def personalized_diagnosis(diag, patient_name):
    pass
    # a) ì•„ë¬´ê²ƒë„ ì²´í¬ë˜ì§€ ì•Šì€ ê²½ìš°
    # b) ì „ì•ˆë¶€ë§Œ ì²´í¬ëœ ê²½ìš°
    # c) ë§ë§‰ ë˜ëŠ” ì‹œì‹ ê²½ ì²´í¬ê°€ ëœê²½ìš°
    # d) ê°ë§‰ ì²´í¬ê°€ ëœ ê²½ìš°
    # e) ì „ë°© ë˜ëŠ” ìˆ˜ì •ì²´ ì²´í¬ê°€ ëœ ê²½ìš°
    # ì¤‘ìš”ë„ : e > d > c > b > a
    cat = ""
    severe = False
    sentence = ""
    detail = []

    # ìµœìƒìœ„(eì™€ d) : ì¼ë°˜ì ì¸ ê²½ìš°ì™€ ë¹„êµí•˜ì—¬ ìœ„í—˜ìš”ì¸ì„ ì¶”ê°€ë¡œ ê°€ì§€ê³  ìˆëŠ” ìƒíƒœ + [ë§ˆì§€ë§‰ ë¬¸ì¥]
    if len(diag["ì „ë°©"]) != 0 or len(diag["ìˆ˜ì •ì²´"]) != 0 or len(diag["ê°ë§‰"]):
        severe = True
        # eë§Œ
        if len(diag["ê°ë§‰"]) == 0:

            if len(diag["ì „ë°©"]) == 0 :
                cat = "ìˆ˜ì •ì²´"
            elif len(diag["ìˆ˜ì •ì²´"]) == 0:
                cat = "ì „ë°©"
            else:
                cat = "ì „ë°© ë° ìˆ˜ì •ì²´"
            
            detail.append("e")
            if "ì‹¬í•œ ë°±ë‚´ì¥(ë°±ìƒ‰, ê°ˆìƒ‰, í›„ë‚­í•˜í˜¼íƒ í¬í•¨)" in diag["ìˆ˜ì •ì²´"]:
                detail.append("e_add")

        else:
            detail.append("e")
            if "ì‹¬í•œ ë°±ë‚´ì¥(ë°±ìƒ‰, ê°ˆìƒ‰, í›„ë‚­í•˜í˜¼íƒ í¬í•¨)" in diag["ìˆ˜ì •ì²´"]:
                detail.append("e_add")
            if len(diag["ì „ë°©"]) != 0 and len(diag["ìˆ˜ì •ì²´"]) !=0:
                cat = "ì „ë°© ë° ìˆ˜ì •ì²´ ê·¸ë¦¬ê³  ê°ë§‰"
            elif len(diag["ìˆ˜ì •ì²´"]) == 0:
                cat = "ì „ë°© ê·¸ë¦¬ê³  ê°ë§‰"
            elif len(diag["ì „ë°©"]) == 0:
                cat = "ìˆ˜ì •ì²´ ê·¸ë¦¬ê³  ê°ë§‰"
            else:
                cat = "ê°ë§‰"
                detail.remove("e")
            detail.append("d")
            if "ë‚´í”¼ì„¸í¬ ì´ìƒ 1200ê°œ ë¯¸ë§Œ" in diag["ê°ë§‰"] or  "ë‚´í”¼ì„¸í¬ ì´ìƒ 1200~1500ê°œ" in diag["ê°ë§‰"]:
                detail.append("d_add")
            
    # ìœ„í—˜ë„ì— ë”°ë¥¸ ì²«ë¬¸ì¥ ì„ íƒ : (e,d / c,b,a)
    if severe:
        sentence = f"{patient_name}ë‹˜ì€ ì¼ë°˜ì ì¸ ê²½ìš°ì™€ ë¹„êµí•˜ì—¬ {cat} ê´€ë ¨ ìœ„í—˜ìš”ì¸(ë“¤)ì„ ì¶”ê°€ë¡œ ê°€ì§€ê³  ìˆëŠ” ìƒíƒœì…ë‹ˆë‹¤.\n"
    else:
        sentence = f"{patient_name}ë‹˜ì€ ë°±ë‚´ì¥ ìˆ˜ìˆ ì˜ ìœ„í—˜ì„±ì´ ë‚®ê³ , í•©ë³‘ì¦ ë°œìƒ ê°€ëŠ¥ì„±ì´ ë†’ì§€ ì•Šì€ ìƒíƒœì…ë‹ˆë‹¤.\n"

    minor_cat = ""
    if len(diag["ë§ë§‰"]) !=0 or len(diag["ì‹œì‹ ê²½"]):
        detail.append("c")
        if len(diag["ì‹œì‹ ê²½"]) == 0:
            minor_cat = "ë§ë§‰"
        elif len(diag["ë§ë§‰"]) == 0:
            minor_cat = "ë…¹ë‚´ì¥"
        else:
            minor_cat = "ë§ë§‰ ë˜ëŠ” ë…¹ë‚´ì¥"

    if len(diag["ì „ì•ˆë¶€"]) != 0:
        detail.append("b")

    info = {
        "e": "ë°±ë‚´ì¥ ìˆ˜ìˆ ì˜ ë‚œì´ë„ê°€ ë†’ê³ , ìˆ˜ìˆ ì˜ ë²”ìœ„ê°€ ì»¤ì§ˆ ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.\n",
        "e_add": "ì‹¬í•œ ë°±ë‚´ì¥ì„ ì œê±°í•˜ëŠ” ê³¼ì •ì—ì„œ ë‚˜íƒ€ë‚˜ëŠ” ê°ë§‰ë¶€ì¢…ìœ¼ë¡œ ì‹œë ¥ í˜¸ì „ì— ì œí•œì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n",
        "d": "ë°±ë‚´ì¥ ìˆ˜ìˆ  í›„ì—ë„ ê°ë§‰ì§ˆí™˜ìœ¼ë¡œ ì¸í•´ ì‹œë ¥íšŒë³µì— ì œí•œì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n",
        "d_add": "ê°ë§‰ë‚´í”¼ì„¸í¬ì˜ ì €í•˜ë¡œ ìˆ˜ìˆ  ì´í›„ ê°ë§‰ ë¶€ì¢…ì´ ë‚˜íƒ€ë‚  ìˆ˜ ìˆìœ¼ë©°, ì´ë¡œ ì¸í•œ ì‹œë ¥ì €í•˜ê°€ ì§€ì†ë  ì‹œ ê°ë§‰ì´ì‹ìˆ ì„ ê³ ë ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n",
        "c": f"ë°±ë‚´ì¥ ìˆ˜ìˆ  í›„ì—ë„ {minor_cat} ì§ˆí™˜ìœ¼ë¡œ ì¸í•´ ì‹œë ¥ í˜¸ì „ì— ì œí•œì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n",
        "b": "ìˆ˜ìˆ  í›„ ê±´ì„±ì•ˆ ì¦ìƒì´ ì•…í™”ë  ìˆ˜ ìˆì–´ ì´ì— ëŒ€í•œ ì§€ì†ì ì¸ ê´€ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.\n"
    }
    sentence += '\n'
    sentence += "\në˜í•œ ".join([info[idx] for idx in detail])

    if severe:
        sentence += '\n'
        sentence += "ì €í¬ ì„¸ë¸Œë€ìŠ¤ ì•ˆê³¼ ë³‘ì› ì˜ë£Œì§„ì€ ì´ëŸ¬í•œ ìœ„í—˜ìš”ì¸(ë“¤)ì„ ì¶©ë¶„íˆ ìˆ™ì§€í•˜ê³  ì¤€ë¹„í•˜ê² ìŠµë‹ˆë‹¤."

    return sentence